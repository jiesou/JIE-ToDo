jQuery=void 0;var $=mdui.$;let saveTasks,saveSettings,MergeData,tasks=[],settings={multiStorage:"true"===window.localStorage.getItem("multiStorage")};function ThrowError(e){lang.wait.push((()=>{const t=()=>{SaveFile(`JIE-ToDo_tasks_multiStorage-${FormatTime()}.json`,new Blob([JSON.stringify({localStorage:window.localStorage.getItem("tasks")||"[]",cookies:decodeURIComponent(document.cookie.match(new RegExp("(?<=tasks=)[^;]+")))})],{type:"text/plain;charset=utf-8"}))};mdui.dialog({title:'<i class="mdui-icon material-icons">warning</i> '+lang["sth-went-wrong"],content:e+" "+lang["critical-error-warn"],buttons:[{text:lang["export-processed-des"],onClick:()=>{SaveFile(`JIE-ToDo_tasks-${FormatTime()}.json`,new Blob([window.localStorage.getItem("tasks")||"[]"],{type:"text/plain;charset=utf-8"}))}},{text:lang["export-multi-storage-des"],onClick:t},{text:lang["export-and-clear-all-data-des"],onClick:()=>{t(),DeleteAllData()}}],history:!1,onClosed:()=>{location.href=GotoPath()}})}))}function DeleteData(e){const t=document.cookie.match(/[^=]+[^;]+/g)||[];for(let e=t.length;e--;)document.cookie=t[e]+"=0;max-age=0";e||(window.localStorage.clear(),location.href=GotoPath())}function GenerationId(){return Math.random().toString(36).slice(-10)+(new Date).getTime().toString(32).slice(-4)}function GotoPath(e){const t=new URL(new URL(location.href).origin+e||"/"),o=new URL(location.href).searchParams.get("language");return o&&t.searchParams.set("language",o),t}function FormatTime(e,t){return(e=e||new Date).toLocaleDateString("zh")+" "+e.toLocaleTimeString("zh",{hour:"2-digit",minute:"2-digit",second:t?"2-digit":void 0})}function ReadFile(e){const t=document.createElement("input");t.type="file",t.style.display="none",t.onchange=o=>{const n=o.target.files[0];if(!n)return;const a=new FileReader;a.onload=o=>{const n=o.target.result;e(n),document.body.removeChild(t)},a.readAsText(n)},document.body.appendChild(t),t.click()}function SaveFile(e,t){if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(t,e);else{const o=document.createElement("a"),n=URL.createObjectURL(t);o.href=n,o.download=e,document.body.appendChild(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(n)}),0)}}(e=>{MergeData=(e,t,o,n)=>{let a=0,i=o||[];switch(e){case"tasks":if(!t&&!o||t&&!t.length&&o&&!o.length){i=[];break}if(!(t&&o&&t.length&&o.length)){i=t&&t.length?t:o,settings.multiStorage&&a++;break}for(const e in i){const s=t[e];!(s.id&&s.updateTime||n)&&ThrowError("id or updateTime Missing");const r=i.findIndex((e=>s.id===e.id));-1===r?(i.push(s),a++,!n&&ThrowError("id Mismatch")):s.updateTime!=o[r].updateTime&&(i[r]=s.updateTime>o[r].updateTime?s:o[r],a++,!n&&ThrowError("updateTime Mismatch"))}break;case"settings":if(!t&&!o){i={};break}if(!t||!o){i=t||o,a=settings.multiStorage?1:0;break}t.updateTime!==o.updateTime&&(a=1,t.updateTime>o.updateTime&&(i=t))}return[a,i]};const t=function(t){const[o,n]=e.get(t),[a,i]=MergeData(t,o,n);return a>0&&e.set(t,i),i},o=function(t,o){e.set(t,o)};tasks=t("tasks"),saveTasks=()=>{o("tasks",tasks)},settings={...settings,...t("settings")},saveSettings=()=>{settings.updateTime=(new Date).getTime();const e=settings.multiStorage;delete settings.multiStorage,o("settings",settings),window.localStorage.setItem("multiStorage",e)}})(settings.multiStorage?{set:function(e,t){window.localStorage.setItem(e,JSON.stringify(t)),document.cookie=e+"="+encodeURIComponent(JSON.stringify(t))+";max-age=10000000000"},get:function(e){return[JSON.parse(window.localStorage.getItem(e)),JSON.parse(decodeURIComponent(document.cookie.match(new RegExp(`(?<=${e}=)[^;]+`))))]}}:{set:function(e,t){window.localStorage.setItem(e,JSON.stringify(t))},get:function(e){return[JSON.parse(window.localStorage.getItem(e))]}});const TimeLeft=(e=>(lang.wait.push((()=>{e=lang,countdown.setLabels(lang["countdown-units"],lang["countdown-units-plural"],lang["countdown-and"],", ",lang["countdown-now"])})),(t,o)=>{if(!t||!o)return["",""];const n=document.body.clientWidth,a=n<360||n>600&&n-600<50||n>1024&&n-1024<200,i=(new Date).getTime();let s,r,l="",c=t-i;if(c<0){if("short"===o)return["blue",a?e.passed:e["already-over"]];"long"===o&&(s="blue",l=e.passed+" ")}return r=c<=6e4?"red":c<=36e5?"orange":c<=432e5?"yellow":c>=2592e5?"green":"theme-text","short"===o?[r,countdown(i,t,~(countdown.SECONDS|countdown.MILLISECONDS|countdown.WEEKS),a?1:2).toString()]:"long"===o?[s||r,l+countdown(i,t,n<1024?countdown.DEFAULTS:~countdown.MILLISECONDS,Math.floor(n/180),1).toString()]:void 0}))({passed:"","already-over":""});